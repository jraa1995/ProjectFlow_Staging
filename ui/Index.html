<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ProjectFlow</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<!-- Frappe Gantt Library -->
<script src="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.css" />
<!-- Chart.js Library for Analytics (UMD Build for GAS Compatibility) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        primary: {
          50: "#fffbeb",
          100: "#fef3c7",
          200: "#fde68a",
          300: "#fcd34d",
          400: "#fbbf24",
          500: "#f59e0b",
          600: "#d97706",
          700: "#b45309",
          800: "#92400e",
          900: "#78350f",
        },
      },
    },
  },
};
</script>
<!--
CRITICAL FIX: In Google Apps Script, file includes work WITHOUT folder prefixes.
When deploying to GAS:
- ui/Styles becomes just 'Styles'
- ui/Scripts becomes just 'Scripts'
The include() function in Code.gs handles this automatically by stripping folder prefixes.
-->
<?!= include('ui/DesignSystem'); ?>
<?!= include('ui/Styles'); ?>
</head>
<body class="bg-gray-100 h-screen overflow-hidden">
<div id="app" class="flex h-full">
<!-- Sidebar -->
<aside id="sidebar" class="w-60 bg-gray-900 text-white flex flex-col">
<!-- Logo -->
<div class="flex items-center gap-2 p-4 border-b border-gray-700">
<i class="fas fa-project-diagram text-primary-500 text-xl"></i>
<span class="font-bold text-lg">ProjectFlow</span>
</div>
<!-- Navigation -->
<nav class="flex-1 py-4 overflow-y-auto">
<div class="px-3 mb-4">
<p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">
Views
</p>
<span class="nav-link active" data-view="my" onclick="switchView('my')">
<i class="fas fa-user w-5"></i> My Board
</span>
<span class="nav-link" data-view="master" onclick="switchView('master')">
<i class="fas fa-layer-group w-5"></i> Master Board
</span>
<span class="nav-link" data-view="timeline" onclick="switchView('timeline')">
<i class="fas fa-chart-gantt w-5"></i> Timeline
</span>
<span class="nav-link" data-view="analytics" onclick="switchView('analytics')">
<i class="fas fa-chart-bar w-5"></i> Analytics
</span>
<span class="nav-link" data-view="list" onclick="switchView('list')">
<i class="fas fa-list w-5"></i> List View
</span>
<span class="nav-link" data-view="calendar" onclick="switchView('calendar')">
<i class="fas fa-calendar w-5"></i> Calendar View
</span>
<span class="nav-link" data-view="matrix" onclick="switchView('matrix')">
<i class="fas fa-th w-5"></i> Matrix View
</span>
<span class="nav-link" data-view="funnel" onclick="switchView('funnel')">
<i class="fas fa-filter w-5"></i> Funnel
</span>
<span class="nav-link" data-view="milestones" onclick="switchView('milestones')">
<i class="fas fa-flag-checkered w-5"></i> Milestones
</span>
</div>
<div class="px-3 mb-4">
<p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">
Projects
</p>
<div id="projectNav">
<span class="nav-link project-link active" data-project=""
onclick="selectProject(null)">
<i class="fas fa-folder w-5"></i> All Projects
</span>
</div>
<span class="nav-link text-primary-400" onclick="openProjectModal()">
<i class="fas fa-plus w-5"></i> New Project
</span>
</div>
</nav>
<!-- User -->
<div class="p-4 border-t border-gray-700">
<div class="flex items-center gap-3">
<div id="userAvatar"
class="w-9 h-9 rounded-full bg-primary-500 flex items-center justify-center font-semibold text-sm">
?
</div>
<div class="flex-1 overflow-hidden">
<div id="userName" class="font-medium text-sm truncate">
Loading...
</div>
<div id="userEmail" class="text-xs text-gray-400 truncate"></div>
</div>
<button
onclick="handleLogout()"
class="text-gray-400 hover:text-white p-1 rounded"
title="Logout"
>
<i class="fas fa-sign-out-alt"></i>
</button>
</div>
</div>
</aside>
<!-- Main Content -->
<main class="flex-1 flex flex-col overflow-hidden">
<!-- Header -->
<header class="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
<div class="flex items-center gap-4">
<h1 id="viewTitle" class="text-xl font-semibold text-gray-900">
My Board
</h1>
<div class="relative">
<input
type="text"
id="searchInput"
placeholder="Search tasks..."
class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm w-64 focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
/>
<i
class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
></i>
</div>
</div>
<div class="flex items-center gap-3">
<button
onclick="loadBoard()"
class="p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg"
title="Refresh"
>
<i class="fas fa-sync-alt"></i>
</button>
<button
onclick="openTaskModal()"
class="px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg text-sm font-medium flex items-center gap-2"
>
<i class="fas fa-plus"></i> New Task
</button>
</div>
</header>
<!-- Stats Bar -->
<div class="bg-white border-b border-gray-200 px-6 py-3">
<div class="flex items-center gap-6 text-sm">
<div class="flex items-center gap-2">
<span class="text-gray-500">Total:</span>
<span id="statTotal" class="font-semibold text-gray-900">0</span>
</div>
<div class="flex items-center gap-2">
<span class="text-gray-500">Completed:</span>
<span id="statCompleted" class="font-semibold text-green-600"
>0</span>
</div>
<div class="flex items-center gap-2">
<span class="text-gray-500">Progress:</span>
<span id="statProgress" class="font-semibold text-primary-600"
>0%</span>
</div>
<div class="flex items-center gap-2">
<span class="text-gray-500">Due Soon:</span>
<span id="statDueSoon" class="font-semibold text-yellow-600"
>0</span>
</div>
<div class="flex items-center gap-2">
<span class="text-gray-500">Overdue:</span>
<span id="statOverdue" class="font-semibold text-red-600">0</span>
</div>
</div>
</div>
<!--
CRITICAL FIX: All three view containers must exist in the DOM
Each has unique ID and starts hidden except the default (boardView)
-->
<!-- Board View (Kanban) - DEFAULT VIEW -->
<div id="boardView" class="flex-1 overflow-auto p-6">
<div id="board" class="flex gap-4 h-full">
<!-- Columns rendered by JavaScript -->
</div>
</div>
<!-- Timeline View (Gantt) -->
<div id="timelineView" class="flex-1 overflow-auto p-4 hidden">
<!-- Timeline Header -->
<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-4">
<div class="flex items-center justify-between mb-4">
<h2 class="text-lg font-semibold text-gray-900">
Project Timeline
</h2>
<div class="flex items-center gap-3">
<!-- View Toggle -->
<div class="flex items-center bg-gray-100 rounded-lg p-1">
<button
onclick="setTimelineViewMode('Week')"
class="px-3 py-1 text-sm rounded-md bg-white shadow-sm font-medium"
>
Week
</button>
<button
onclick="setTimelineViewMode('Month')"
class="px-3 py-1 text-sm rounded-md text-gray-600 hover:bg-white"
>
Month
</button>
</div>
<button
onclick="loadTimelineData()"
class="px-3 py-2 bg-primary-500 text-white rounded-lg text-sm hover:bg-primary-600"
>
<i class="fas fa-sync-alt mr-1"></i> Refresh
</button>
</div>
</div>
<!-- Filters -->
<div class="flex items-center gap-4">
<select
id="timelineStatusFilter"
onchange="applyTimelineFilters()"
class="px-3 py-2 border border-gray-300 rounded-lg text-sm"
>
<option value="">All Statuses</option>
</select>
<select
id="timelinePriorityFilter"
onchange="applyTimelineFilters()"
class="px-3 py-2 border border-gray-300 rounded-lg text-sm"
>
<option value="">All Priorities</option>
</select>
<input
type="text"
id="timelineSearch"
placeholder="Search tasks..."
onkeyup="applyTimelineFilters()"
class="px-3 py-2 border border-gray-300 rounded-lg text-sm w-48"
/>
<button
onclick="clearTimelineFilters()"
class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm"
>
Clear Filters
</button>
</div>
</div>
<!-- Gantt Chart Container -->
<div class="bg-white rounded-lg shadow-sm border border-gray-200">
<div id="ganttContainer" class="p-4 min-h-[400px]">
<div class="flex items-center justify-center h-64 text-gray-500">
<i class="fas fa-spinner fa-spin text-2xl mr-2"></i> Loading
timeline...
</div>
</div>
</div>
<!-- Timeline List View -->
<div id="timelineListContainer" class="bg-white rounded-lg shadow-sm border border-gray-200 mt-4">
<div class="p-4 border-b border-gray-200">
<h3 class="font-medium text-gray-900">Timeline Tasks</h3>
</div>
<div id="timelineList" class="divide-y divide-gray-200">
<!-- Timeline list items rendered by JS -->
</div>
</div>
</div>
<!-- Funnel View -->
<div id="funnelView" class="flex-1 overflow-auto p-4 hidden">
<?!= include('ui/FunnelView'); ?>
</div>
<!-- Phase 3.1: List View -->
<div id="listView" class="flex-1 overflow-auto hidden">
<?!= include('ui/ListView'); ?>
</div>
<!-- Phase 3.2: Calendar View -->
<div id="calendarView" class="flex-1 overflow-auto hidden">
<?!= include('ui/CalendarView'); ?>
</div>
<!-- Phase 3.3: Matrix View -->
<div id="matrixView" class="flex-1 overflow-auto hidden">
<?!= include('ui/MatrixView'); ?>
</div>
<!-- Phase 1: Milestone View -->
<div id="milestoneViewContainer" class="flex-1 overflow-hidden hidden">
<?!= include('ui/MilestoneView'); ?>
</div>
<!-- Analytics View -->
<div id="analyticsView" class="flex-1 overflow-auto p-4 hidden">
<!-- Analytics Header -->
<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
<div class="flex items-center justify-between mb-4">
<h2 class="text-lg font-semibold text-gray-900">
Analytics Dashboard
</h2>
<div class="flex items-center gap-3">
<!-- Time Range Filter -->
<div class="flex items-center gap-2">
<label class="text-sm text-gray-600">Time Range:</label>
<select
id="analyticsDateRange"
onchange="refreshAnalytics()"
class="px-3 py-1 border border-gray-300 rounded text-sm"
>
<option value="7">Last 7 days</option>
<option value="30" selected>Last 30 days</option>
<option value="90">Last 90 days</option>
<option value="365">Last year</option>
</select>
</div>
<!-- Refresh Button -->
<button
onclick="refreshAnalytics()"
class="px-3 py-2 bg-primary-500 text-white rounded-lg text-sm hover:bg-primary-600"
>
<i class="fas fa-sync-alt mr-1"></i> Refresh
</button>
</div>
</div>
<!-- Key Metrics -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4">
<div class="bg-blue-50 p-4 rounded-lg">
<div class="text-2xl font-bold text-blue-600" id="analyticsStatTotal">
-
</div>
<div class="text-blue-800 text-sm">Total Tasks</div>
</div>
<div class="bg-green-50 p-4 rounded-lg">
<div class="text-2xl font-bold text-green-600" id="analyticsStatCompleted">
-
</div>
<div class="text-green-800 text-sm">Completed</div>
</div>
<div class="bg-yellow-50 p-4 rounded-lg">
<div class="text-2xl font-bold text-yellow-600" id="analyticsStatInProgress">
-
</div>
<div class="text-yellow-800 text-sm">In Progress</div>
</div>
<div class="bg-red-50 p-4 rounded-lg">
<div class="text-2xl font-bold text-red-600" id="analyticsStatOverdue">
-
</div>
<div class="text-red-800 text-sm">Overdue</div>
</div>
</div>
</div>
<!-- Charts Row -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
<!-- Completion Trend Chart -->
<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
<h3 class="text-md font-semibold text-gray-900 mb-4">
Completion Trend
</h3>
<div class="h-64">
<canvas id="completionTrendCanvas"></canvas>
</div>
</div>
<!-- Priority Distribution Chart -->
<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
<h3 class="text-md font-semibold text-gray-900 mb-4">
Priority Distribution
</h3>
<div class="h-64">
<canvas id="priorityChartCanvas"></canvas>
</div>
</div>
</div>
<!-- Team & Project Row -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
<!-- Team Productivity -->
<div class="bg-white rounded-lg shadow-sm border border-gray-200">
<div class="p-4 border-b border-gray-200">
<h3 class="font-semibold text-gray-900">Team Productivity</h3>
</div>
<div id="teamProductivityList" class="divide-y divide-gray-100 max-h-80 overflow-auto">
<div class="p-4 text-center text-gray-500">Loading...</div>
</div>
</div>
<!-- Project Health -->
<div class="bg-white rounded-lg shadow-sm border border-gray-200">
<div class="p-4 border-b border-gray-200">
<h3 class="font-semibold text-gray-900">Project Health</h3>
</div>
<div id="projectHealthList" class="max-h-80 overflow-auto">
<div class="p-4 text-center text-gray-500">Loading...</div>
</div>
</div>
</div>
<!-- Recent Activity -->
<div class="bg-white rounded-lg shadow-sm border border-gray-200 mt-6">
<div class="p-4 border-b border-gray-200">
<h3 class="font-semibold text-gray-900">Recent Activity</h3>
</div>
<div id="recentActivity" class="divide-y divide-gray-100 max-h-80 overflow-auto">
<div class="p-4 text-center text-gray-500">Loading...</div>
</div>
</div>
</div>
</main>
</div>
<!-- Loading Overlay -->
<div id="loadingOverlay" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
<div class="bg-white rounded-lg p-6 flex items-center gap-4 shadow-xl">
<i class="fas fa-spinner fa-spin text-primary-500 text-2xl"></i>
<span class="text-gray-700 font-medium">Loading...</span>
</div>
</div>
<!-- Task Modal -->
<div id="taskModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
<div class="bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden">
<div class="flex items-center justify-between px-6 py-4 border-b">
<h2 id="modalTitle" class="text-lg font-semibold text-gray-900">
New Task
</h2>
<button
onclick="closeTaskModal()"
class="text-gray-400 hover:text-gray-600"
>
<i class="fas fa-times text-xl"></i>
</button>
</div>
<form id="taskForm" onsubmit="saveTask(event)" class="overflow-y-auto max-h-[calc(90vh-130px)]">
<div class="p-6 space-y-4">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1"
>Title *</label>
<input
type="text"
id="taskTitle"
required
class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"
/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1"
>Description</label>
<textarea
id="taskDescription"
rows="3"
class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"
></textarea>
</div>
<div class="grid grid-cols-2 gap-4">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1"
>Status</label>
<select
id="taskStatus"
class="w-full px-3 py-2 border border-gray-300 rounded-lg"
>
<option value="To Do">To Do</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1"
>Priority</label>
<select
id="taskPriority"
class="w-full px-3 py-2 border border-gray-300 rounded-lg"
>
<option value="Medium">Medium</option>
</select>
</div>
</div>
<div class="grid grid-cols-2 gap-4">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1"
>Type</label>
<select
id="taskType"
class="w-full px-3 py-2 border border-gray-300 rounded-lg"
>
<option value="Task">Task</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1"
>Project</label>
<select
id="taskProject"
class="w-full px-3 py-2 border border-gray-300 rounded-lg"
>
<option value="">No Project</option>
</select>
</div>
</div>
<div class="grid grid-cols-2 gap-4">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1"
>Assignee</label>
<select
id="taskAssignee"
class="w-full px-3 py-2 border border-gray-300 rounded-lg"
>
<option value="">Unassigned</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1"
>Due Date</label>
<input
type="date"
id="taskDueDate"
class="w-full px-3 py-2 border border-gray-300 rounded-lg"
/>
</div>
</div>
<div class="grid grid-cols-2 gap-4">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1"
>Start Date</label>
<input
type="date"
id="taskStartDate"
class="w-full px-3 py-2 border border-gray-300 rounded-lg"
/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1"
>Estimated Hours</label>
<input
type="number"
id="taskEstimatedHrs"
min="0"
step="0.5"
class="w-full px-3 py-2 border border-gray-300 rounded-lg"
/>
</div>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1"
>Story Points</label>
<input
type="number"
id="taskStoryPoints"
min="0"
class="w-full px-3 py-2 border border-gray-300 rounded-lg"
/>
</div>
</div>
<div class="flex items-center justify-between px-6 py-4 border-t bg-gray-50">
<button
type="button"
onclick="deleteTask()"
id="deleteTaskBtn"
class="px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg text-sm hidden"
>
<i class="fas fa-trash mr-1"></i> Delete
</button>
<div class="flex items-center gap-3">
<button
type="button"
onclick="closeTaskModal()"
class="px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg text-sm"
>
Cancel
</button>
<button
type="submit"
class="px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg text-sm"
>
<i class="fas fa-save mr-1"></i> Save Task
</button>
</div>
</div>
</form>
</div>
</div>
<!-- Project Modal -->
<div id="projectModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
<div class="bg-white rounded-xl shadow-xl w-full max-w-md">
<div class="flex items-center justify-between px-6 py-4 border-b">
<h2 class="text-lg font-semibold text-gray-900">New Project</h2>
<button
onclick="closeProjectModal()"
class="text-gray-400 hover:text-gray-600"
>
<i class="fas fa-times text-xl"></i>
</button>
</div>
<form onsubmit="saveProject(event)" class="p-6 space-y-4">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1"
>Project Name *</label>
<input
type="text"
id="projectName"
required
class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"
/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1"
>Description</label>
<textarea
id="projectDescription"
rows="3"
class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"
></textarea>
</div>
<div class="flex items-center justify-end gap-3 pt-4">
<button
type="button"
onclick="closeProjectModal()"
class="px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg text-sm"
>
Cancel
</button>
<button
type="submit"
class="px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg text-sm"
>
<i class="fas fa-save mr-1"></i> Create Project
</button>
</div>
</form>
</div>
</div>
<!-- Toast Container -->
<div id="toastContainer" class="fixed bottom-4 right-4 z-50 space-y-2"></div>
<!-- Login Modal -->
<div id="loginModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
<div class="bg-white rounded-xl shadow-xl w-full max-w-md p-8">
<!-- Logo and Branding -->
<div class="text-center mb-8">
<div class="flex items-center justify-center gap-3 mb-4">
<i class="fas fa-project-diagram text-primary-500 text-3xl"></i>
<span class="font-bold text-2xl text-gray-900">ProjectFlow</span>
</div>
<p class="text-gray-600">Sign in to continue to your workspace</p>
</div>
<!-- Login Form -->
<form id="loginForm" onsubmit="LoginModal.handleLogin(event)">
<div class="mb-6">
<label for="loginEmail" class="block text-sm font-medium text-gray-700 mb-2">
Email Address
</label>
<div class="relative">
<span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">
<i class="fas fa-envelope"></i>
</span>
<input
type="email"
id="loginEmail"
name="email"
required
placeholder="you@company.com"
class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-gray-900"
autocomplete="email"
/>
</div>
</div>
<!-- Error Message Display -->
<div id="loginError" class="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm hidden">
<div class="flex items-center gap-2">
<i class="fas fa-exclamation-circle"></i>
<span id="loginErrorText">An error occurred</span>
</div>
</div>
<!-- Submit Button -->
<button
type="submit"
id="loginSubmitBtn"
class="w-full py-3 bg-primary-500 hover:bg-primary-600 text-white rounded-lg font-medium flex items-center justify-center gap-2 transition-colors"
>
<span id="loginBtnText">Sign In</span>
<i id="loginSpinner" class="fas fa-spinner fa-spin hidden"></i>
</button>
</form>
<!-- Help Text -->
<div class="mt-6 text-center text-sm text-gray-500">
<p>Need access? Contact your administrator.</p>
</div>
</div>
</div>
<!--
CRITICAL FIX: Include only Scripts.html
REMOVED: TimelineIntegration.html (was overriding switchView causing conflicts)
The Scripts.html now contains all unified view switching logic
CacheService must be loaded BEFORE Scripts.html for IndexedDB caching
-->
<?!= include('ui/CacheService'); ?>
<?!= include('ui/Scripts'); ?>
<?!= include('ui/GanttChart'); ?>
<?!= include('ui/MentionAutocomplete'); ?>
<?!= include('ui/TaskDetailPanel'); ?>
<?!= include('ui/TaskEditModal'); ?>
<?!= include('ui/DependencyPicker'); ?>
<?!= include('ui/NotificationCenter'); ?>
</body>
</html>